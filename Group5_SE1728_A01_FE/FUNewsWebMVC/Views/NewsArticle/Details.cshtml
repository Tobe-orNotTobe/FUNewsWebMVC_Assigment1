@model NewsArticle
@{
    ViewData["Title"] = Model.NewsTitle;
    var canManage = ViewBag.CanManage as bool? ?? false;
}

<div class="container">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <!-- Article Header -->
            <div class="card mb-4">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h1 class="h2 mb-2 text-primary">@Model.NewsTitle</h1>
                            <p class="lead text-muted mb-0">@Model.Headline</p>
                        </div>
                        <div>
                            @if (Model.NewsStatus == true)
                            {
                                <span class="badge bg-success fs-6">Published</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary fs-6">Draft</span>
                            }
                        </div>
                    </div>
                </div>

                <!-- Article Metadata -->
                <div class="card-body border-bottom bg-light">
                    <div class="row text-muted small">
                        <div class="col-md-6">
                            <p class="mb-1">
                                <i class="fas fa-user me-2"></i>
                                <strong>Author:</strong> @(Model.CreatedBy?.AccountName ?? "Unknown")
                            </p>
                            <p class="mb-1">
                                <i class="fas fa-calendar me-2"></i>
                                <strong>Published:</strong> @Model.CreatedDate?.ToString("MMM dd, yyyy")
                            </p>
                            @if (Model.ModifiedDate.HasValue)
                            {
                                <p class="mb-1">
                                    <i class="fas fa-edit me-2"></i>
                                    <strong>Last Updated:</strong> @Model.ModifiedDate?.ToString("MMM dd, yyyy")
                                </p>
                            }
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1">
                                <i class="fas fa-folder me-2"></i>
                                <strong>Category:</strong>
                                @if (Model.Category != null)
                                {
                                    <span class="badge bg-info">@Model.Category.CategoryName</span>
                                }
                                else
                                {
                                    <span class="text-muted">No Category</span>
                                }
                            </p>
                            <p class="mb-1">
                                <i class="fas fa-hashtag me-2"></i>
                                <strong>Article ID:</strong>
                                <code>@Model.NewsArticleId</code>
                            </p>
                            @if (!string.IsNullOrEmpty(Model.NewsSource))
                            {
                                <p class="mb-1">
                                    <i class="fas fa-link me-2"></i>
                                    <strong>Source:</strong>
                                    <a href="@Model.NewsSource" target="_blank" class="text-decoration-none">
                                        View Source
                                    </a>
                                </p>
                            }
                        </div>
                    </div>

                    <!-- Tags -->
                    @if (Model.Tags != null && Model.Tags.Any())
                    {
                        <div class="mt-3 pt-3 border-top">
                            <strong class="text-muted me-2">Tags:</strong>
                            @foreach (var tag in Model.Tags)
                            {
                                <span class="badge bg-light text-dark me-1">#@tag.TagName</span>
                            }
                        </div>
                    }
                </div>

                <!-- Article Content -->
                <div class="card-body">
                    <div class="article-content" style="line-height: 1.8; font-size: 1.1rem;">
                        @if (!string.IsNullOrEmpty(Model.NewsContent))
                        {
                            @Html.Raw(Model.NewsContent.Replace("\n", "<br/>"))
                        }
                        else
                        {
                            <div class="text-center py-5">
                                <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                                <p class="text-muted fst-italic">No content available for this article.</p>
                            </div>
                        }
                    </div>

                    <!-- Reading Stats -->
                    @if (!string.IsNullOrEmpty(Model.NewsContent))
                    {
                        <div class="mt-4 pt-3 border-top">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                Word count: @Model.NewsContent.Split(' ', StringSplitOptions.RemoveEmptyEntries).Length words
                            </small>
                        </div>
                    }
                </div>

                <!-- Action Buttons -->
                <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <a asp-action="Index" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i>
                                Back to Articles
                            </a>
                            @if (Model.Category != null)
                            {
                                <a asp-action="Index" asp-route-categoryId="@Model.Category.CategoryId"
                                   class="btn btn-outline-info ms-2">
                                    <i class="fas fa-folder me-1"></i>
                                    More in @Model.Category.CategoryName
                                </a>
                            }
                        </div>

                        <!-- Share buttons -->
                        <div>
                            <button type="button" class="btn btn-outline-primary btn-sm me-1" onclick="shareArticle()">
                                <i class="fas fa-share me-1"></i>Share
                            </button>
                            <button type="button" class="btn btn-outline-success btn-sm me-1" onclick="copyLink()">
                                <i class="fas fa-copy me-1"></i>Copy Link
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.print()">
                                <i class="fas fa-print me-1"></i>Print
                            </button>
                        </div>

                        @if (canManage)
                        {
                            <div>
                                <a asp-action="Edit" asp-route-id="@Model.NewsArticleId"
                                   class="btn btn-warning me-1">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </a>
                                <button type="button" class="btn btn-@(Model.NewsStatus == true ? "secondary" : "success") me-1"
                                        onclick="toggleStatus('@Model.NewsArticleId')">
                                    <i class="fas fa-@(Model.NewsStatus == true ? "eye-slash" : "eye") me-1"></i>
                                    @(Model.NewsStatus == true ? "Unpublish" : "Publish")
                                </button>
                                <a asp-action="Delete" asp-route-id="@Model.NewsArticleId"
                                   class="btn btn-danger"
                                   onclick="return confirmDelete('Are you sure you want to delete this article?')">
                                    <i class="fas fa-trash me-1"></i>Delete
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Related Articles -->
            @if (Model.Category != null)
            {
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-newspaper me-2"></i>
                            More Articles in @Model.Category.CategoryName
                        </h5>
                    </div>
                    <div class="card-body">
                        <a asp-action="Index" asp-route-categoryId="@Model.Category.CategoryId"
                           class="btn btn-outline-primary">
                            <i class="fas fa-list me-1"></i>
                            View All Articles in This Category
                        </a>
                        <a asp-action="Index" asp-route-filter="active"
                           class="btn btn-outline-success ms-2">
                            <i class="fas fa-eye me-1"></i>
                            Browse Published Articles
                        </a>
                    </div>
                </div>
            }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>Article Info
                    </h6>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td>Status:</td>
                            <td>
                                @if (Model.NewsStatus == true)
                                {
                                    <span class="badge bg-success">Published</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Draft</span>
                                }
                            </td>
                        </tr>
                        <tr>
                            <td>Words:</td>
                            <td>@(Model.NewsContent?.Split(' ', StringSplitOptions.RemoveEmptyEntries).Length ?? 0)</td>
                        </tr>
                        <tr>
                            <td>Characters:</td>
                            <td>@(Model.NewsContent?.Length ?? 0)</td>
                        </tr>
                        <tr>
                            <td>Tags:</td>
                            <td>@(Model.Tags?.Count ?? 0)</td>
                        </tr>
                    </table>
                </div>
            </div>

            @if (canManage)
            {
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-cog me-2"></i>Quick Actions
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a asp-action="Edit" asp-route-id="@Model.NewsArticleId"
                               class="btn btn-outline-warning btn-sm">
                                <i class="fas fa-edit me-1"></i>Edit Article
                            </a>
                            <button type="button" class="btn btn-outline-info btn-sm"
                                    onclick="toggleStatus('@Model.NewsArticleId')">
                                <i class="fas fa-sync me-1"></i>Toggle Status
                            </button>
                            <a asp-action="Create" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-plus me-1"></i>Create New Article
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Share article
        function shareArticle() {
            if (navigator.share) {
                navigator.share({
                    title: '@Model.NewsTitle',
                    text: '@Model.Headline',
                    url: window.location.href
                });
            } else {
                // Fallback
                copyLink();
            }
        }

        // Copy link to clipboard
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(function() {
                alert('Article link copied to clipboard!');
            });
        }

        // Toggle status
        function toggleStatus(articleId) {
            if (!confirm('Are you sure you want to change the status of this article?')) {
                return;
            }

            fetch('/NewsArticle/ToggleStatus', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(articleId)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error updating status');
                console.error('Error:', error);
            });
        }

        // Confirm delete
        function confirmDelete(message) {
            return confirm(message);
        }
    </script>
}